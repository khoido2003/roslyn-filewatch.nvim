*roslyn-filewatch.txt*             File watcher for Roslyn LSP in Neovim (C#) 

==============================================================================
Table of Contents                         *roslyn-filewatch-table-of-contents*

1. roslyn-filewatch.nvim              |roslyn-filewatch-roslyn-filewatch.nvim|
  - ‚ö° Why?                 |roslyn-filewatch-roslyn-filewatch.nvim-‚ö°-why?|
  - ‚ú® Features         |roslyn-filewatch-roslyn-filewatch.nvim-‚ú®-features|
  - üîå Requirements|roslyn-filewatch-roslyn-filewatch.nvim-üîå-requirements|
  - üì¶ Installation|roslyn-filewatch-roslyn-filewatch.nvim-üì¶-installation|
  - üìò User Manual |roslyn-filewatch-roslyn-filewatch.nvim-üìò-user-manual|
  - üß≠ Command Reference|roslyn-filewatch-roslyn-filewatch.nvim-üß≠-command-reference|
  - ÔøΩ Maintainer Guide|roslyn-filewatch-roslyn-filewatch.nvim-ÔøΩ-maintainer-guide|
  - ‚ö†Ô∏è Known Limitations|roslyn-filewatch-roslyn-filewatch.nvim-‚ö†Ô∏è-known-limitations|
  - üìú License         |roslyn-filewatch-roslyn-filewatch.nvim-üìú-license|
  - ‚ù§Ô∏è Acknowledgements|roslyn-filewatch-roslyn-filewatch.nvim-‚ù§Ô∏è-acknowledgements|

==============================================================================
1. roslyn-filewatch.nvim              *roslyn-filewatch-roslyn-filewatch.nvim*

A lightweight, **file-watching and project-sync plugin** for Neovim that keeps
the **Roslyn LSP** up-to-date with file changes.

Now with built-in **Dotnet CLI integration**, **Game Engine support**, and
**Snippet** management.

------------------------------------------------------------------------------

‚ö° WHY?                     *roslyn-filewatch-roslyn-filewatch.nvim-‚ö°-why?*

Roslyn does not watch your project files by default in Neovim/Linux/Mac.
Without this, you often need to `:edit!` or restart the LSP to make Roslyn
notice file creation, deletion, renaming, or solution changes.

This plugin adds a robust **cross-platform file watcher** and a suite of tools
to make C# development in Neovim feel like a full IDE.

------------------------------------------------------------------------------

‚ú® FEATURES             *roslyn-filewatch-roslyn-filewatch.nvim-‚ú®-features*


üóÇÔ∏è ROBUST FILE WATCHING ~

- **Cross-Platform**: Uses `uv.fs_event` (native) with `uv.fs_poll` (fallback) for reliability on Windows/Linux/macOS.
- **Smart Detection**: Handles create, delete, change, and **detects renames** (merging delete+create pairs).
- **Optimization**: Batches events, throttles diagnostics, and avoids watching ignored files (ignores `.git`, `bin`, `obj`, etc.).
- **Solution-Aware**: Parses `.sln`, `.slnx`, or `.slnf` files to strictly limit watching to relevant project folders.
- **csproj-only Support**: Fully supports projects without solution files - automatically detects and watches all `.csproj` files recursively, ensuring new files are immediately recognized by the LSP.


üöÄ PERFORMANCE & SMART LOADING ~

- **Deferred Loading**: Delays project loading until you actually open a C# file to speed up startup for large solutions.
- **Project Warm-up**: Sends initialization notifications to get Roslyn ready without blocking the UI.
- **Diagnostic Throttling**: Prevents UI lag by smoothing out diagnostic updates during heavy operations (like git checkout).


üéÆ GAME ENGINE SUPPORT ~

First-class support for **C# Game Development**. Automatically detects the
engine and applies optimized presets (scan intervals, ignore patterns): -
**Unity**: Parses `.asmdef`, configures analyzers, handles meta files. -
**Godot**: Handles `project.godot` and `.godot/`. - **Stride**, **MonoGame**,
**FNA**: Preset configurations included.


üõ†Ô∏è INTEGRATED TOOLING (OPT-IN) ~

Enable these features in your config to get a full C# IDE experience: -
**Dotnet CLI**: Build, Run, Watch, Clean, and create Projects directly from
Neovim. - **NuGet**: Manage packages (Add/Remove/Restore) interactively. -
**Auto-Restore**: Automatically runs `dotnet restore` when `.csproj` files are
modified (opt-in). - **Snippets**: A collection of 150+ snippets for Unity,
Godot, and ASP.NET (requires LuaSnip). - **Solution Explorer**: A tree-view
picker to navigate your solution (`:RoslynExplorer`).

------------------------------------------------------------------------------

üîå REQUIREMENTS   *roslyn-filewatch-roslyn-filewatch.nvim-üîå-requirements*

- **Neovim 0.10+** (Required for `vim.fs` and modern Lua APIs)
- An existing Roslyn LSP client, such as:
    - roslyn.nvim <https://github.com/seblyng/roslyn.nvim> (**Highly recommended**)
    - nvim-lspconfig (roslyn_ls) <https://github.com/neovim/nvim-lspconfig/blob/master/doc/configs.md#roslyn_ls>

------------------------------------------------------------------------------

üì¶ INSTALLATION   *roslyn-filewatch-roslyn-filewatch.nvim-üì¶-installation*


LAZY.NVIM ~

>lua
    {
      "khoido2003/roslyn-filewatch.nvim",
      config = function()
        require("roslyn_filewatch").setup()
      end,
    }
<


PACKER.NVIM ~

>lua
    use {
      "khoido2003/roslyn-filewatch.nvim",
      config = function()
        require("roslyn_filewatch").setup()
      end,
    }
<

------------------------------------------------------------------------------

üìò USER MANUAL     *roslyn-filewatch-roslyn-filewatch.nvim-üìò-user-manual*

This section covers how to configure and use the plugin effectively in your
daily workflow.


1. CONFIGURATION ~

The following settings are commonly adjusted:

>lua
    require("roslyn_filewatch").setup({
      -- === Core Settings ===
      -- List of LSP client names to hook into (required)
      client_names = { "roslyn_ls", "roslyn", "roslyn_lsp" },
      
      -- Project preset: "auto", "unity", "console", "large", "none"
      -- "auto" detects Unity/Godot/Large projects and applies optimized settings
      preset = "auto", 
      
      -- Logging level: vim.log.levels.WARN, INFO, DEBUG, TRACE
      log_level = vim.log.levels.WARN,
    
      -- === Performance & Loading ===
      -- Defer project loading until first C# file is opened
      deferred_loading = true,
      deferred_loading_delay_ms = 500,
      
      -- Diagnostic throttling reduces UI lag during heavy file changes
      diagnostic_throttling = {
        enabled = true,
        debounce_ms = 500,  -- Wait 500ms before requesting diagnostics
        visible_only = true, -- Only request diagnostics for visible buffers
      },
    
      -- === File Watching Configuration ===
      -- Directories to completely ignore (exact case-insensitive match)
      ignore_dirs = { 
        "Library", "Temp", "Obj", "Bin", ".git", ".idea", ".vs", 
        ".godot", ".mono", "node_modules" 
      },
      
      -- Glob patterns to exclude (follows gitignore syntax)
      -- Example: { "*.generated.cs", "**/foo/**" }
      ignore_patterns = {},
      
      -- List of extensions to watch
      watch_extensions = { 
        ".cs", ".csproj", ".sln", ".slnx", ".slnf", 
        ".props", ".targets", ".razor", ".cshtml", ".xaml" 
      },
    
      -- Parse .sln/.slnx/.slnf to limit watch scope to project folders
      -- Highly recommended for performance on monorepos
      solution_aware = true, 
      
      -- Respect standard .gitignore files
      respect_gitignore = true,
    
      -- === Event Processing ===
      -- Batch multiple events into single notifications
      batching = {
        enabled = true,
        interval = 300, -- Window to coalesce events (ms)
      },
      
      -- Debounce time for processing file system events
      processing_debounce_ms = 150,
      
      -- Quiet period (seconds) required after activity before triggering full scans
      -- Helps prevents freezing during massive changes (e.g. Unity re-import)
      activity_quiet_period = 5,
      
      -- Rename detection window (ms) to merge delete+create into rename
      rename_detection_ms = 200,
    
      -- === Advanced / Fallback ===
      -- Polling interval (ms) for fallback watcher and resilience checks
      poll_interval = 5000, 
      
      -- Force non-native polling mode (not recommended unless fs_event fails)
      force_polling = false,
      
      -- === Optional Features (Default: false) ===
      -- Enable built-in Dotnet CLI commands (:RoslynBuild, :RoslynRun, etc.)
      enable_dotnet_commands = false,
      
      -- Enable NuGet package management commands
      enable_nuget_commands = false,
    
      -- Enable auto-restore of NuGet packages on .csproj change
      enable_autorestore = true,
      
      -- Enable C# snippets (requires LuaSnip)
      enable_snippets = false,
    })
<


2. COMMON WORKFLOWS ~


A. STARTING A NEW PROJECT

1. Run `:RoslynNewProject`.
2. Select a template (e.g., `console`, `webapi`, `classlib`).
3. Enter a name.
4. The plugin creates the project folder and file.
5. _(Optional)_ Open it immediately with `:RoslynOpenCsproj`.


B. ADDING A DEPENDENCY

Instead of switching to the terminal: 1. Run `:RoslynNuget`. 2. Type
`Newtonsoft.Json`. 3. The plugin finds the nearest `.csproj` and installs the
package. 4. Roslyn automatically picks up the reference because the file
watcher sees the change.


C. WORKING WITH UNITY

1. Open your Unity project folder in Neovim.
2. The plugin detects `Assets/` and `ProjectSettings/`.
3. It automatically switches to the **Unity Preset**:- Ignores `Library`, `Temp`, `Logs`.
- Increases debounce time (Unity likes to touch many files at once).
- Adds `UNT` analyzer rules to your LSP configuration.


4. **Tip**: Use `:RoslynEngineInfo` to confirm Unity mode is active.


D. NAVIGATING LARGE SOLUTIONS

1. Run `:RoslynExplorer`.
2. You see a tree view: `Solution` -> `Project A` -> `Folder` -> `File.cs`.
3. Select a file to open.
4. _Note_: This respects `.sln` structure, so it‚Äôs cleaner than a raw file tree.

------------------------------------------------------------------------------

üß≠ COMMAND REFERENCE*roslyn-filewatch-roslyn-filewatch.nvim-üß≠-command-reference*

Most commands are **interactive**‚Äîif you run them without arguments, a
selection menu will appear.


üìÇ CORE (ALWAYS AVAILABLE) ~

  --------------------------------------------------------------------------
  Command                Usage               Description
  ---------------------- ------------------- -------------------------------
  :RoslynExplorer        :RoslynExplorer     Interactive Solution/Project
                                             explorer.

  :RoslynFiles           :RoslynFiles        Fuzzy find C# files within the
                                             solution scope.

  :RoslynStatus          :RoslynStatus       Debug Tool: Shows active
                                             watcher status, tracked
                                             projects, and health.

  :RoslynReload          :RoslynReload       Emergency Fix: Forces Roslyn to
                                             reload all project files. Use
                                             if Intellisense breaks.

  :RoslynEngineInfo      :RoslynEngineInfo   Shows detected game engine and
                                             active settings.
  --------------------------------------------------------------------------

üî® BUILD & RUN (ENABLE_DOTNET_COMMANDS = TRUE) ~

  -------------------------------------------------------------------------------------
  Command                Usage                          Description
  ---------------------- ------------------------------ -------------------------------
  :RoslynBuild           :RoslynBuild [Release/Debug]   Builds the solution.

  :RoslynRun             :RoslynRun [ProjectName]       Runs a project. Interactive if
                                                        multiple executable projects
                                                        exist.

  :RoslynWatch           :RoslynWatch                   Starts dotnet watch in a
                                                        terminal buffer for Hot Reload.

  :RoslynClean           :RoslynClean                   Deletes bin/ and obj/ folders.
  -------------------------------------------------------------------------------------

üì¶ NUGET (ENABLE_NUGET_COMMANDS = TRUE) ~

  -----------------------------------------------------------------------------------
  Command                Usage                        Description
  ---------------------- ---------------------------- -------------------------------
  :RoslynNuget           :RoslynNuget [PackageName]   Adds a NuGet package to the
                                                      current project.

  :RoslynNugetRemove     :RoslynNugetRemove           Shows a list of installed
                                                      packages to remove.

  :RoslynRestore         :RoslynRestore               Runs dotnet restore to download
                                                      missing packages.
  -----------------------------------------------------------------------------------
------------------------------------------------------------------------------

ÔøΩ MAINTAINER GUIDE*roslyn-filewatch-roslyn-filewatch.nvim-ÔøΩ-maintainer-guide*

For developers contributing to `roslyn-filewatch.nvim`, this section details
the architecture.


üó∫Ô∏è THE CODE MAP ~


PROJECT STRUCTURE

This plugin keeps Roslyn aware of **file system changes**:

- `lua/roslyn_filewatch/`
    - **Core Logic**:
        - `init.lua`: The entry point. Handles setup and command registration.
        - `watcher.lua`: The brain. Manages `uv.fs_event` handles and the polling loop.
        - `snapshot.lua`: The memory. Maintains the state of the filesystem (`path -> {mtime, size, inode}`). Computes diffs.
        - `config.lua`: Validation and default options.
    - **Features**:
        - `dotnet_cli.lua`: Wraps the `dotnet` binary. Handles messy job of parsing CLI output.
        - `explorer.lua`: Implements the Tree View UI (using `vim.ui.select` or Telescope if available).
        - `snippets.lua`: Definitions for Unity/Godot snippets.
    - **Engine Support**:
        - `presets.lua`: Registry of game engines.
        - `game_engines/`: Individual logic for Unity, Godot, etc. detection.

1. **fs_event** (`uv.fs_event`)- Listens for low-level file changes.
- Fast and efficient where supported.


2. **fs_poll** (`uv.fs_poll`)- Polls periodically as a fallback.
- Detects missed events and validates file integrity.


3. **Snapshots** (`snapshot.lua`)- Keeps an in-memory map of files and their metadata (mtime, inode, size).
- Allows diffing to detect _created_, _deleted_, or _changed_ files.


4. **Rename detection** (`rename.lua`)- If a file is deleted and a new one created within a short window ‚Üí treat as **rename**.
- Sends Roslyn `workspace/didRenameFiles` instead of separate delete/create.


5. **Batching**- Groups multiple events into a single LSP notification to reduce traffic.


6. **Watchdog**- Restarts the watcher if no events are seen for too long (e.g.¬†Unity reload).
- Ensures resilience against dropped events.


7. **Autocmds**- Hooks into Neovim‚Äôs buffer lifecycle (`BufWritePost`, `BufDelete`, etc.).
- Keeps open buffers and file state in sync.


8. **Notifications**- Translates events into Roslyn-compatible LSP notifications:
    - `workspace/didChangeWatchedFiles`
    - `workspace/didRenameFiles`




‚öôÔ∏è THE WATCH CYCLE (HOW IT ACTUALLY WORKS) ~

1. **Startup**:- `LspAttach` autocmd triggers `watcher.start()`.
- `snapshot.create()` scans the root dir recursively (respecting `.gitignore` and `ignore_dirs`).
- Initial state is stored.


2. **Monitoring**:- Attempts to attach a `uv.fs_event` to the root directory (recursive).
- **Windows Quirk**: `uv.fs_event` on Windows is recursive by default.
- **Linux/Mac Quirk**: `uv.fs_event` is NOT recursive. Falls back to `uv.fs_poll` or recursive watching (depending on implementation version).


3. **The Event Loop**:- **Event**: File system event fires (or poll interval ticks).
- **Debounce**: Waits `processing_debounce_ms` (default 150ms) to let bursts settle (e.g., `git checkout`).
- **Scan**: Scans the _affected path_ (or full tree if path unknown).
- **Diff**: Compares new scan vs old snapshot.
    - `Snapshot: nil`, `Disk: exists` -> **Created**
    - `Snapshot: exists`, `Disk: nil` -> **Deleted**
    - `Snapshot: mtime=X`, `Disk: mtime=Y` -> **Changed**
- **Rename Heuristic**:
    - If `Delete(A)` and `Create(B)` occur in the same batch‚Ä¶
    - AND `inode(A) == inode(B)` (if supported) OR `size(A) == size(B)`‚Ä¶
    - The events are marked as **Renamed**.


4. **Notification**:- Changes are formatted into LSP `FileEvent` objects.
- `workspace/didChangeWatchedFiles` or `workspace/didRenameFiles` notifications are sent to Roslyn.




‚ùì TROUBLESHOOTING & DEBUGGING ~

**‚ÄúThe watcher is not watching files‚Äù** 1. Turn on debug logs: `setup({
log_level = vim.log.levels.DEBUG })`. 2. Run `:messages`. 3. Check
`:RoslynStatus`. * **Healthy**: "Watcher: Running (fs_event)" * **Issue**:
"Watcher: Polling (Fallback)" -> Might be slower.

**‚ÄúIt freezes when I change branch‚Äù** 1. This means the dirty scan is
taking too long. 2. Increase `poll_interval` or `processing_debounce_ms`. 3.
Ensure `ignore_dirs` includes your build artifacts (`bin`, `obj`).


‚ûï HOW TO ADD A NEW GAME ENGINE ~

1. **Create file**: `lua/roslyn_filewatch/game_engines/my_engine.lua`.
2. **Implement**:
`lua     local M = {}     M.detect = function(root)       return vim.fn.filereadable(root .. "/my_engine_config.json") == 1     end     M.get_config = function()        return { ignore_dirs = { "EngineCache" } }     end     return M`
3. **Register**: Add it to `lua/roslyn_filewatch/presets.lua` in the `engine_check_order` list.

------------------------------------------------------------------------------

‚ö†Ô∏è KNOWN LIMITATIONS*roslyn-filewatch-roslyn-filewatch.nvim-‚ö†Ô∏è-known-limitations*

1. **Massive Repositories (10k+ files)**- **Issue**: Initial scan might cause a brief CPU spike.
- **Workaround**: `deferred_loading = true` is enabled by default to delay parsing until work begins.
- **Optimization**: Ensure your `ignore_dirs` list includes all build/cache folders (e.g., `dist`, `node_modules`).


2. **Network Shares (NFS/SMB)**- **Issue**: Native file watching (`fs_event`) is notoriously flaky on network drives.
- **Workaround**: The plugin attempts to fall back to polling, but latency will be higher.


3. **Linux/BSD: ‚ÄúENOSPC‚Äù Error**- **Issue**: You might hit the system limit for file watchers.
- **Fix**: Increase `fs.inotify.max_user_watches` with `sysctl` (Standard Linux limitation).


4. **External Changes (Git/Unity)**- **Issue**: Mass changes from outside Neovim (like `git checkout` or Unity re-importing assets) triggers thousands of events.
- **Mitigation**: Automatically throttle these bursts using `processing_debounce_ms` and `activity_quiet_period`, so Neovim stays responsive, but Roslyn might take a few seconds to catch up.


5. **csproj-only Projects (Fixed in v0.3.5)**- **Previously**: Projects without `.sln`/`.slnx` files had issues with new files not being recognized by the LSP.
- **Now Fixed**: The plugin automatically:
    - Recursively scans for all `.csproj` files in the project
    - Sends `project/open` notifications when new source files are created or opened
    - Triggers Roslyn project reload via csproj CHANGE events (same as opening old files)
    - Automatically restores dependencies when needed (if `enable_autorestore = true`)
    - Debounces notifications to prevent constant restores and reduce lag
- **Note**: For best results with csproj-only projects, ensure `enable_autorestore = true` is set in your config.



------------------------------------------------------------------------------

üìú LICENSE             *roslyn-filewatch-roslyn-filewatch.nvim-üìú-license*

MIT License.


‚ù§Ô∏è ACKNOWLEDGEMENTS*roslyn-filewatch-roslyn-filewatch.nvim-‚ù§Ô∏è-acknowledgements*

- Inspired by the pain of using Roslyn in Neovim without file watchers üòÖ
- Thanks to Neovim‚Äôs `vim.uv` for making cross-platform file watching possible.

Generated by panvimdoc <https://github.com/kdheepak/panvimdoc>

vim:tw=78:ts=8:noet:ft=help:norl:
